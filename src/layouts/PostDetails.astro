---
import Layout from '@/layouts/Layout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import Tag from '@/components/Tag.astro'
import Datetime from '@/components/Datetime'
import type { CollectionEntry } from 'astro:content'
import { slugifyStr } from '@/utils/slugify'
import { SITE } from '@/config'

export interface Props {
  post: CollectionEntry<'blog'>
}

const { post } = Astro.props

const { title, author, description, ogImage, canonicalURL, pubDatetime, tags } = post.data

const { Content } = await post.render()

const ogImageUrl = typeof ogImage === 'string' ? ogImage : ogImage?.src
const ogUrl = new URL(ogImageUrl ?? `${SITE.base}/posts/${slugifyStr(title)}.png`, Astro.url.origin).href
---

<Layout title={title} author={author} description={description} ogImage={ogUrl} canonicalURL={canonicalURL}>
  <Header />
  <div class='mx-auto flex w-full max-w-3xl justify-start px-2'>
    <button class='focus-outline mb-2 mt-4 flex hover:op-75' onclick='history.back()'>
      <i class="i-custom-back text-2xl"></i>
      <span>返回</span>
    </button>
  </div>
  <main id='main-content' class='mx-auto w-full max-w-3xl px-4 pb-12'>
    <h1 transition:name={slugifyStr(title)} class='text-2xl font-semibold c-accent'>{title}</h1>
    <Datetime datetime={pubDatetime} size='lg' className='my-2' />
    <article id='article' role='article' class='prose mx-auto mt-8 max-w-3xl'>
      <Content />
    </article>

    <ul class='my-8'>
      {tags.map((tag) => <Tag name={slugifyStr(tag)} />)}
    </ul>
  </main>
  <Footer />
</Layout>
